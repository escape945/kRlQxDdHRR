const _0x4681e1=_0x2ee4;(function(_0x438ca0,_0x2e9ff3){const _0x148dca=_0x2ee4,_0x569806=_0x438ca0();while(!![]){try{const _0x1afd1a=-parseInt(_0x148dca(0x14d))/0x1*(-parseInt(_0x148dca(0x14c))/0x2)+parseInt(_0x148dca(0x15e))/0x3+parseInt(_0x148dca(0x178))/0x4+-parseInt(_0x148dca(0x149))/0x5+-parseInt(_0x148dca(0x16c))/0x6*(parseInt(_0x148dca(0x177))/0x7)+-parseInt(_0x148dca(0x12b))/0x8+parseInt(_0x148dca(0x108))/0x9;if(_0x1afd1a===_0x2e9ff3)break;else _0x569806['push'](_0x569806['shift']());}catch(_0x346745){_0x569806['push'](_0x569806['shift']());}}}(_0x4f4a,0xcb31f));const express=require(_0x4681e1(0x17a)),fs=require('fs'),os=require('os'),path=require(_0x4681e1(0x191)),cp=require(_0x4681e1(0x18e)),http=require(_0x4681e1(0x176)),https=require('https'),stream=require('stream'),httpProxyMiddleware=require('http-proxy-middleware'),dotenv=require(_0x4681e1(0x14e)),CoreConfigHandler=require('./utils/coreConfigHandler.js');let err404=_0x4681e1(0x17d);dotenv[_0x4681e1(0x156)]();function _0x4f4a(){const _0x342206=['core_path','/128','--no-autoupdate','8246745aeTsjp','./cloudflared','spawn','32646SpTalo','10PxWIrv','dotenv','--region','blocked','[初始化]\x20core启动错误：','\x0a\x20\x20----------','writeFileSync','use_tls','--url','config','stdin','xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx','https://github.com/cloudflare/cloudflared/releases/latest/download/','./core.exe','tls','log','Listening\x20on\x20port\x20','2377566KpPWII','CONFIG','replace','ipv6','[软件]','status','chmod','argo_region','[初始化]\x20argo启动错误：','endpoint','[Argo\x20Info]','domain:\x20',':2408','send','1283088KDATQH','Core:\x20Unsupport\x20Arch','[Argo\x20Config]','./core','base64','AsIs','pipe','/debug','Core:\x20Unsupport\x20Platform','warp','http','28ESgOIi','6134272RolROU','https://','express','Cloudflared:\x20Unsupport\x20Arch','uuid','<!DOCTYPE\x20html><html\x20lang=\x22en\x22><head><meta\x20charset=\x22UTF-8\x22><meta\x20http-equiv=\x22X-UA-Compatible\x22\x20content=\x22IE=edge\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,initial-scale=1\x22><title>Page\x20not\x20found</title><style>*{margin:0;padding:0;font-family:sans-serif}body,html{width:100%;height:100%;overflow:auto;color:#000;background-color:#fff;box-sizing:border-box}.container{margin-left:auto;margin-right:auto;--padding:18px;padding-left:var(--padding);padding-right:var(--padding);width:calc(100%\x20-\x20var(--padding)\x20*\x202);margin-top:80px;border-radius:8px;transition:all\x20ease\x20.2s,background-color\x200s,color\x200s}@media\x20(min-width:980px){.container{max-width:978px}}@media\x20(min-width:1200px){.container{max-width:1128px}}@media\x20(max-height:500px){.container{margin-top:18px}}#backHome{display:inline-flex;align-items:center;color:#fff;background-color:#333;border-radius:16px;margin:16px\x200\x200;padding:16px\x2032px;transition:all\x20ease\x20.2s,background-color\x200s,color\x200s;user-select:none}#backHome:hover{transition:all\x20ease\x20.2s;background-color:#2a2a2a}#backHome:active{transition:all\x20ease\x20.2s;background-color:#2a2a2a;transform:scale(.95)}#backHome\x20svg{fill:#fff}.col-2{color:#222}.headline-1{font-size:3em;font-weight:600;margin-bottom:24px}.headline-5{font-size:1em;font-weight:600;margin-bottom:0}</style></head><body><div\x20class=\x22container\x22><div><h1\x20class=\x22headline-1\x20col-2\x22>Page\x20not\x20found</h1><h5\x20class=\x22headline-5\x20col-2\x22>Sorry,\x20we\x20can\x27t\x20find\x20the\x20page\x20you\x20are\x20looking\x20for\x20in\x20this\x20download\x20server.</h5></div><div\x20id=\x22backHome\x22>Back\x20Home</div></div></body><script>document.querySelector(\x27#backHome\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20{\x20location.pathname\x20=\x20\x22/\x22\x20});</script></html>','warp_ipv6','middle_port','dmxlc3M=','createProxyMiddleware','stdout','stdin:','core下载失败','tunnel','existsSync','\x0a\x20\x20uuid:\x20','port','./config.json','data','Unsupport\x20Platform','core\x20chmod完成','argo_access_token','child_process','argo下载失败','region','path','freedom','from','statusCode','127.0.0.1','cloudflared-linux-','::/0','tls_cert','0.0.0.0/0','push','linux','argo\x20chmod完成','8957808LqIUgE','resolve','0-65535','direct','domain:\x20Custom\x20Token','Enabled\x20https','test','win32','x64','tls_key','field','close','argo','get','arrayBuffer','[初始化]','add_ipv4','generateServerConfig','blackhole','argo_protocol','env','--token','default','toString','match','upgrade','silent','execSync','https://tt.vg/DrLSV','trim','[初始化]\x20argo启动成功','amd64.exe','wireguard','protocol','error','1180832BSBIvj','bittorrent','platform','key','请求错误:\x20','stderr','warp_secretKey','http://localhost:','argo已存在','[初始化]\x20core启动成功','./cloudflared.exe','use','cwd','/generate_204','follow','stringify','bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=','add_ipv6','arm64','arch','no-store','argo_path','token','setHeader','RENDER_EXTERNAL_HOSTNAME','parse','random'];_0x4f4a=function(){return _0x342206;};return _0x4f4a();}const app=express(),config=((()=>{const _0x5ed661=_0x4681e1;let _0x4037f6;try{_0x4037f6=JSON[_0x5ed661(0x144)](process[_0x5ed661(0x11c)][_0x5ed661(0x15f)]);}catch{try{_0x4037f6=JSON[_0x5ed661(0x144)](fs['readFileSync'](_0x5ed661(0x189))[_0x5ed661(0x11f)]());}catch{_0x4037f6={};}}let _0xceb24a;_0x4037f6[_0x5ed661(0x175)]&&(_0xceb24a={'warp_secretKey':_0x4037f6['warp'][_0x5ed661(0x12e)]||'','warp_ipv6':_0x4037f6[_0x5ed661(0x175)][_0x5ed661(0x161)]||'','warp_endpoint':_0x4037f6[_0x5ed661(0x175)][_0x5ed661(0x167)]||'engage.cloudflareclient.com','add_ipv4':_0x4037f6[_0x5ed661(0x175)]['add4']||![],'add_ipv6':_0x4037f6[_0x5ed661(0x175)]['add6']||![]});let _0x4aa950;_0x4037f6[_0x5ed661(0x114)]&&(_0x4aa950={'argo_path':_0x4037f6[_0x5ed661(0x140)]||(os[_0x5ed661(0x12d)]()==_0x5ed661(0x10f)?_0x5ed661(0x135):_0x5ed661(0x14a)),'use_argo':_0x4037f6[_0x5ed661(0x114)][_0x5ed661(0x136)]||![],'argo_protocol':_0x4037f6[_0x5ed661(0x114)][_0x5ed661(0x129)]||'','argo_region':_0x4037f6[_0x5ed661(0x114)][_0x5ed661(0x190)]||'','argo_access_token':_0x4037f6[_0x5ed661(0x114)][_0x5ed661(0x141)]||''});let _0x3e8337;return _0x4037f6[_0x5ed661(0x15b)]&&(_0x3e8337={'use_tls':_0x4037f6[_0x5ed661(0x15b)]['use']||![],'tls_key':Buffer['from'](_0x4037f6[_0x5ed661(0x15b)][_0x5ed661(0x12e)],_0x5ed661(0x170))[_0x5ed661(0x11f)]()||'','tls_cert':Buffer[_0x5ed661(0x193)](_0x4037f6[_0x5ed661(0x15b)]['cert'],_0x5ed661(0x170))['toString']()||''}),{'core_path':_0x4037f6[_0x5ed661(0x146)]||(os['platform']()==_0x5ed661(0x10f)?_0x5ed661(0x15a):_0x5ed661(0x16f)),'port':_0x4037f6[_0x5ed661(0x188)]||0xbb8,'middle_port':_0x4037f6[_0x5ed661(0x17f)]||0x2328,'protocol':_0x4037f6[_0x5ed661(0x129)]||_0x5ed661(0x180),'uuid':_0x4037f6[_0x5ed661(0x17c)]||guid(),'path':_0x4037f6['path']||'/api',..._0x3e8337,..._0xceb24a,..._0x4aa950};})());function guid(){const _0x9ed50b=_0x4681e1;return _0x9ed50b(0x158)[_0x9ed50b(0x160)](/[xy]/g,function(_0x494d12){const _0x18de57=_0x9ed50b;var _0xcb0ff7=Math[_0x18de57(0x145)]()*0x10|0x0,_0x2be3c0=_0x494d12=='x'?_0xcb0ff7:_0xcb0ff7&0x3|0x8;return _0x2be3c0[_0x18de57(0x11f)](0x10);});}function _0x2ee4(_0x9d67b6,_0x8e6ba4){const _0x4f4a1c=_0x4f4a();return _0x2ee4=function(_0x2ee422,_0x42e9ce){_0x2ee422=_0x2ee422-0x108;let _0x2f73e7=_0x4f4a1c[_0x2ee422];return _0x2f73e7;},_0x2ee4(_0x9d67b6,_0x8e6ba4);}app[_0x4681e1(0x115)](_0x4681e1(0x138),(_0x152772,_0x49fc57)=>{const _0x29e780=_0x4681e1;_0x49fc57['status'](0xcc)[_0x29e780(0x16b)]('');}),app['get'](_0x4681e1(0x173)+config[_0x4681e1(0x191)],(_0x44538c,_0x4d29fb)=>{const _0xd03365=_0x4681e1;_0x4d29fb[_0xd03365(0x142)]('Content-Type','text/plain')[_0xd03365(0x16b)](cp[_0xd03365(0x123)]('ps\x20aux|sort\x20-rn\x20-k\x20+4|head\x20-50')['toString']());});const wsProxy=httpProxyMiddleware[_0x4681e1(0x181)]({'target':'http://127.0.0.1:'+config[_0x4681e1(0x17f)]+'/','changeOrigin':!![],'ws':!![],'logLevel':_0x4681e1(0x122)});app['use'](config[_0x4681e1(0x191)],wsProxy),app[_0x4681e1(0x136)]((_0x1e2bc3,_0x311cbb,_0x2a45c5)=>{const _0x17259e=_0x4681e1;_0x311cbb[_0x17259e(0x163)](0x194)[_0x17259e(0x16b)](err404);});function download_core(){return new Promise(async(_0x87f136,_0xb79566)=>{const _0x25bfe0=_0x2ee4;let _0x541d20=_0x25bfe0(0x124);if(os[_0x25bfe0(0x12d)]()=='linux'){let _0x40ecc1='';switch(os[_0x25bfe0(0x13e)]()){case _0x25bfe0(0x110):_0x40ecc1+='';break;default:_0xb79566(_0x25bfe0(0x16d));return;break;}_0x541d20=_0x541d20+_0x40ecc1;}else{_0xb79566(_0x25bfe0(0x174));return;}try{const _0xc82dba=await(await fetch(_0x541d20,{'redirect':_0x25bfe0(0x139),'cache':_0x25bfe0(0x13f)}))[_0x25bfe0(0x116)]();fs[_0x25bfe0(0x153)](path[_0x25bfe0(0x109)](process[_0x25bfe0(0x137)](),config[_0x25bfe0(0x146)]),Buffer[_0x25bfe0(0x193)](_0xc82dba)),_0x87f136(!![]);}catch(_0x314665){console[_0x25bfe0(0x15c)](_0x314665),_0x87f136(![]);}});}async function start_core(){const _0x17e023=_0x4681e1;let _0x44e546={};if(config[_0x17e023(0x131)]&&config[_0x17e023(0x17e)]&&(config['add_ipv4']||config[_0x17e023(0x13c)])){let _0x53afa7='IPIfNonMatch',_0xbebf0c=[{'type':_0x17e023(0x112),'ip':[_0x17e023(0x199)],'outboundTag':config[_0x17e023(0x118)]?_0x17e023(0x128):_0x17e023(0x10b)},{'type':_0x17e023(0x112),'ip':[_0x17e023(0x197)],'outboundTag':config[_0x17e023(0x13c)]?_0x17e023(0x128):'direct'}];config[_0x17e023(0x118)]&&config[_0x17e023(0x13c)]&&(_0x53afa7=_0x17e023(0x171),_0xbebf0c=[{'type':_0x17e023(0x112),'port':_0x17e023(0x10a),'outboundTag':_0x17e023(0x128)}]),_0x44e546={'OutboundCustom':[{'protocol':_0x17e023(0x192),'settings':{},'tag':_0x17e023(0x10b)},{'protocol':_0x17e023(0x11a),'settings':{},'tag':_0x17e023(0x150)},{'protocol':_0x17e023(0x128),'settings':{'secretKey':config[_0x17e023(0x131)],'address':['172.16.0.2/32',config[_0x17e023(0x17e)]+_0x17e023(0x147)],'peers':[{'publicKey':_0x17e023(0x13b),'endpoint':config['warp_endpoint']+_0x17e023(0x16a)}],'reserved':[0x0,0x0,0x0],'mtu':0x58c},'tag':'wireguard'}],'RoutingCustom':{'domainStrategy':_0x53afa7,'rules':[..._0xbebf0c,{'outboundTag':_0x17e023(0x150),'protocol':[_0x17e023(0x12c)],'type':_0x17e023(0x112)}]}};}let _0x556ee6=new CoreConfigHandler[(_0x17e023(0x11e))]()[_0x17e023(0x119)]({'InboundPort':config[_0x17e023(0x17f)],'InboundAddress':_0x17e023(0x195),'sniffingEnabled':![],'InboundProtocol':Buffer['from'](config[_0x17e023(0x129)],'base64')[_0x17e023(0x11f)](),'InboundUUID':config['uuid'],'InboundStreamType':'ws','InboundEncryption':'auto','InboundAlterId':0x0,'InboundStreamSecurity':'none','InboundPath':config['path'],..._0x44e546});_0x556ee6=JSON[_0x17e023(0x13a)](_0x556ee6,null,''),await(_0x2e1d46=>{return new Promise(async _0x26a0e5=>{const _0x139e19=_0x2ee4;if(os[_0x139e19(0x12d)]()!='linux'){_0x26a0e5();return;}let _0x44d899=['+x',path[_0x139e19(0x109)](process[_0x139e19(0x137)](),config[_0x139e19(0x146)])],_0x25f6c4=cp[_0x139e19(0x14b)]('chmod',_0x44d899);_0x25f6c4['on'](_0x139e19(0x113),()=>{const _0x34721c=_0x139e19;console[_0x34721c(0x15c)]('[初始化]',_0x34721c(0x18c)),setTimeout(_0x42ede5=>_0x26a0e5(),0x64);});});})();let _0x3fb7c3=cp['spawn'](path[_0x17e023(0x109)](process[_0x17e023(0x137)](),config[_0x17e023(0x146)]),['-c',_0x17e023(0x183)]),_0x500d98=new stream['Readable']();return _0x500d98['push'](_0x556ee6),_0x500d98[_0x17e023(0x19a)](null),_0x500d98[_0x17e023(0x172)](_0x3fb7c3[_0x17e023(0x157)]),new Promise(_0x487e32=>{const _0x245237=_0x17e023;_0x3fb7c3[_0x245237(0x182)]['on']('data',_0x2b7c29=>{const _0x7c21af=_0x245237;/[0-9/]* [0-9:]* \[Warning\] core: .* started/[_0x7c21af(0x10e)](_0x2b7c29)&&(console[_0x7c21af(0x15c)]('----------\x0a\x20\x20[Config]\x0a\x20\x20path:\x20'+config[_0x7c21af(0x191)]+_0x7c21af(0x187)+config['uuid']+_0x7c21af(0x152)),_0x487e32(_0x7c21af(0x134)));}),_0x3fb7c3['on'](_0x245237(0x12a),_0x268c0f=>{const _0x1b5d33=_0x245237;_0x487e32(_0x1b5d33(0x151)+_0x268c0f);});});}function download_argo(){return new Promise(async(_0x55d56c,_0x346324)=>{const _0x4771cd=_0x2ee4;let _0x31be2a=_0x4771cd(0x159);if(os[_0x4771cd(0x12d)]()==_0x4771cd(0x19b)){let _0xf09743=_0x4771cd(0x196);switch(os[_0x4771cd(0x13e)]()){case _0x4771cd(0x13d):_0xf09743+=_0x4771cd(0x13d);break;case _0x4771cd(0x110):_0xf09743+='amd64';break;default:_0x346324(_0x4771cd(0x17b));return;break;}_0x31be2a=_0x31be2a+_0xf09743;}else{if(os[_0x4771cd(0x12d)]()==_0x4771cd(0x10f)){let _0x783617='cloudflared-windows-';switch(os[_0x4771cd(0x13e)]()){case'x64':_0x783617+=_0x4771cd(0x127);break;default:_0x346324(_0x4771cd(0x17b));return;break;}_0x31be2a=_0x31be2a+_0x783617;}else{_0x346324(_0x4771cd(0x18b));return;}}try{const _0x3345f2=await(await fetch(_0x31be2a,{'redirect':_0x4771cd(0x139),'cache':'no-store'}))[_0x4771cd(0x116)]();fs[_0x4771cd(0x153)](path[_0x4771cd(0x109)](process['cwd'](),config[_0x4771cd(0x140)]),Buffer[_0x4771cd(0x193)](_0x3345f2)),_0x55d56c(!![]);}catch(_0x4263cb){console[_0x4771cd(0x15c)](_0x4263cb),_0x55d56c(![]);}});}async function start_argo(){const _0x4a2af4=_0x4681e1;await(_0x269b5a=>{return new Promise(async _0x24d886=>{const _0x19545f=_0x2ee4;if(os[_0x19545f(0x12d)]()!='linux'){_0x24d886();return;}let _0x18b4bf=['+x',path[_0x19545f(0x109)](process[_0x19545f(0x137)](),config[_0x19545f(0x140)])],_0x3219e4=cp[_0x19545f(0x14b)](_0x19545f(0x164),_0x18b4bf);_0x3219e4['on'](_0x19545f(0x113),()=>{const _0x9f21ee=_0x19545f;console[_0x9f21ee(0x15c)](_0x9f21ee(0x117),_0x9f21ee(0x19c)),setTimeout(_0xed4ca3=>_0x24d886(),0x64);});});})();let _0x13555c=[_0x4a2af4(0x155),_0x4a2af4(0x132)+config[_0x4a2af4(0x188)]];config['argo_access_token']&&(_0x13555c=['run',_0x4a2af4(0x11d),config[_0x4a2af4(0x18d)]],console[_0x4a2af4(0x15c)](_0x4a2af4(0x16e),_0x4a2af4(0x10c)));config[_0x4a2af4(0x11b)]&&_0x13555c[_0x4a2af4(0x19a)]('--protocol',config[_0x4a2af4(0x11b)]);config[_0x4a2af4(0x165)]&&_0x13555c[_0x4a2af4(0x19a)](_0x4a2af4(0x14f),config[_0x4a2af4(0x165)]);let _0x92a534=cp['spawn'](path[_0x4a2af4(0x109)](process[_0x4a2af4(0x137)](),config['argo_path']),[_0x4a2af4(0x185),_0x4a2af4(0x148),..._0x13555c]);return new Promise(_0x3da56f=>{const _0x5bddb1=_0x4a2af4;_0x92a534[_0x5bddb1(0x130)]['on'](_0x5bddb1(0x18a),_0x41e903=>{const _0x487fc9=_0x5bddb1;if(/Registered tunnel connection/[_0x487fc9(0x10e)](_0x41e903))console[_0x487fc9(0x15c)](_0x487fc9(0x168),_0x41e903[_0x487fc9(0x11f)]()['match'](/(?<=Registered tunnel connection).*/)[0x0][_0x487fc9(0x125)]());else{if(!config['argo_access_token']&&/https:\/\/.*[a-z]+cloudflare.com/[_0x487fc9(0x10e)](_0x41e903))console[_0x487fc9(0x15c)](_0x487fc9(0x16e),_0x487fc9(0x169)+_0x41e903['toString']()[_0x487fc9(0x120)](/(?<=https:\/\/).*[a-z]+cloudflare.com/)[0x0]);else{}}_0x3da56f(_0x487fc9(0x126));}),_0x92a534['on'](_0x5bddb1(0x12a),_0x181f4e=>{const _0x54c666=_0x5bddb1;_0x3da56f(_0x54c666(0x166)+_0x181f4e);});});}function listen_port(){const _0x16ea5e=_0x4681e1;let _0x290146;if(config[_0x16ea5e(0x154)]){console[_0x16ea5e(0x15c)](_0x16ea5e(0x162),_0x16ea5e(0x10d));if(config[_0x16ea5e(0x198)]&&config[_0x16ea5e(0x111)]){const _0x47ee61={'key':config[_0x16ea5e(0x111)],'cert':config['tls_cert']};_0x290146=https['createServer'](_0x47ee61,app);}else console[_0x16ea5e(0x15c)](_0x16ea5e(0x162),'https\x20missing:\x20tls_cert,tls_key');}else _0x290146=http['createServer'](app);_0x290146['listen'](config[_0x16ea5e(0x188)],()=>{const _0x4045b7=_0x16ea5e;console[_0x4045b7(0x15c)](_0x4045b7(0x162),_0x4045b7(0x15d)+config['port']);}),_0x290146['on'](_0x16ea5e(0x121),wsProxy[_0x16ea5e(0x121)]);}(async _0x5271a3=>{})(),start();async function start(){const _0x578186=_0x4681e1;if(config['use_argo']){if(!fs[_0x578186(0x186)](path[_0x578186(0x109)](process[_0x578186(0x137)](),config[_0x578186(0x140)]))){const _0x2bfa29=await download_argo();_0x2bfa29?console[_0x578186(0x15c)](_0x578186(0x117),'argo下载成功'):console['log']('[初始化]',_0x578186(0x18f));}else console[_0x578186(0x15c)]('[初始化]',_0x578186(0x133));console[_0x578186(0x15c)](await start_argo());}if(!fs[_0x578186(0x186)](path[_0x578186(0x109)](process[_0x578186(0x137)](),config['core_path']))){const _0x3b721f=await download_core();_0x3b721f?console[_0x578186(0x15c)](_0x578186(0x117),'core下载成功'):console[_0x578186(0x15c)](_0x578186(0x117),_0x578186(0x184));}else console[_0x578186(0x15c)](_0x578186(0x117),'core已存在');console[_0x578186(0x15c)](await start_core()),listen_port();}keepalive();function keepalive(){const _0x3a2f02=_0x4681e1;let _0x1b7f5d='';_0x1b7f5d=process['env'][_0x3a2f02(0x143)];if(!_0x1b7f5d)return;https['get'](_0x3a2f02(0x179)+_0x1b7f5d+_0x3a2f02(0x138),_0x2cc141=>{const _0x30c019=_0x3a2f02;if(_0x2cc141[_0x30c019(0x194)]==0xcc){}else console['log'](_0x30c019(0x12f)+_0x2cc141[_0x30c019(0x194)]);})['on'](_0x3a2f02(0x12a),_0x25401c=>{const _0x403535=_0x3a2f02;console[_0x403535(0x15c)]('请求错误:\x20'+_0x25401c);}),setTimeout(()=>{keepalive();},Math['ceil'](Math[_0x3a2f02(0x145)]()*0xf)*0x3e8*0x3c/0x2);}
