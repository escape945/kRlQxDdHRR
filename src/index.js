const _0x301135=_0x2537;(function(_0x1f343e,_0x16b3fb){const _0x5d93c7=_0x2537,_0x225970=_0x1f343e();while(!![]){try{const _0x36baf3=-parseInt(_0x5d93c7(0x196))/0x1+parseInt(_0x5d93c7(0x156))/0x2+parseInt(_0x5d93c7(0x19e))/0x3+-parseInt(_0x5d93c7(0x190))/0x4+-parseInt(_0x5d93c7(0x15f))/0x5*(parseInt(_0x5d93c7(0x192))/0x6)+-parseInt(_0x5d93c7(0x174))/0x7+-parseInt(_0x5d93c7(0x169))/0x8*(-parseInt(_0x5d93c7(0x19d))/0x9);if(_0x36baf3===_0x16b3fb)break;else _0x225970['push'](_0x225970['shift']());}catch(_0x38efdf){_0x225970['push'](_0x225970['shift']());}}}(_0x5e74,0x81dfb));const express=require(_0x301135(0x1b9)),fs=require('fs'),os=require('os'),path=require(_0x301135(0x1be)),cp=require(_0x301135(0x193)),http=require(_0x301135(0x160)),https=require(_0x301135(0x14d)),stream=require(_0x301135(0x19a)),httpProxyMiddleware=require(_0x301135(0x177)),dotenv=require('dotenv'),CoreConfigHandler=require(_0x301135(0x197));let err404=_0x301135(0x173);dotenv[_0x301135(0x1bd)]();const app=express(),config=((()=>{const _0xb93515=_0x301135;let _0x18cc8a=JSON['parse'](process['env'][_0xb93515(0x150)]),_0x135c39;_0x18cc8a[_0xb93515(0x152)]&&(_0x135c39={'warp_secretKey':_0x18cc8a[_0xb93515(0x152)][_0xb93515(0x15d)]||'','warp_ipv6':_0x18cc8a['warp'][_0xb93515(0x16f)]||'','warp_endpoint':_0x18cc8a[_0xb93515(0x152)]['endpoint']||_0xb93515(0x143),'add_ipv4':_0x18cc8a['warp']['add4']||![],'add_ipv6':_0x18cc8a[_0xb93515(0x152)][_0xb93515(0x158)]||![]});let _0x1b2536;_0x18cc8a['argo']&&(_0x1b2536={'argo_path':_0x18cc8a[_0xb93515(0x145)]||(os[_0xb93515(0x18a)]()==_0xb93515(0x139)?'./cloudflared.exe':'./cloudflared'),'use_argo':_0x18cc8a[_0xb93515(0x16c)][_0xb93515(0x1bb)]||![],'argo_protocol':_0x18cc8a[_0xb93515(0x16c)][_0xb93515(0x183)]||'','argo_region':_0x18cc8a[_0xb93515(0x16c)]['region']||'','argo_access_token':_0x18cc8a[_0xb93515(0x16c)]['token']||''});let _0x4ec24e;return _0x18cc8a[_0xb93515(0x16a)]&&(_0x4ec24e={'use_tls':_0x18cc8a['tls'][_0xb93515(0x1bb)]||![],'tls_key':Buffer[_0xb93515(0x1ad)](_0x18cc8a[_0xb93515(0x16a)][_0xb93515(0x15d)],_0xb93515(0x15c))['toString']()||'','tls_cert':Buffer['from'](_0x18cc8a[_0xb93515(0x16a)]['cert'],_0xb93515(0x15c))[_0xb93515(0x155)]()||''}),{'core_path':_0x18cc8a[_0xb93515(0x198)]||(os[_0xb93515(0x18a)]()==_0xb93515(0x139)?_0xb93515(0x1ab):'./core'),'port':_0x18cc8a['port']||0xbb8,'middle_port':_0x18cc8a[_0xb93515(0x17a)]||0x2328,'protocol':_0x18cc8a['protocol']||_0xb93515(0x1a6),'uuid':_0x18cc8a[_0xb93515(0x17b)]||guid(),'path':_0x18cc8a['path']||'/api',..._0x4ec24e,..._0x135c39,..._0x1b2536};})());function guid(){const _0x2e7c34=_0x301135;return _0x2e7c34(0x18c)[_0x2e7c34(0x13e)](/[xy]/g,function(_0x142537){const _0x16a427=_0x2e7c34;var _0x52ebb0=Math['random']()*0x10|0x0,_0x382acc=_0x142537=='x'?_0x52ebb0:_0x52ebb0&0x3|0x8;return _0x382acc[_0x16a427(0x155)](0x10);});}app[_0x301135(0x17d)](_0x301135(0x151),(_0x4c5330,_0x5ac14d)=>{const _0x2eae9b=_0x301135;_0x5ac14d[_0x2eae9b(0x19f)](0xcc)[_0x2eae9b(0x1c9)]('');}),app['get'](_0x301135(0x15b)+config[_0x301135(0x1be)],(_0x58b35c,_0x42c702)=>{const _0xfef126=_0x301135;_0x42c702[_0xfef126(0x1c9)](cp[_0xfef126(0x1a8)](_0xfef126(0x19b))['toString']());});const wsProxy=httpProxyMiddleware[_0x301135(0x146)]({'target':_0x301135(0x189)+config[_0x301135(0x17a)]+'/','changeOrigin':!![],'ws':!![],'logLevel':_0x301135(0x161)});app[_0x301135(0x1bb)](config[_0x301135(0x1be)],wsProxy),app[_0x301135(0x1bb)]((_0x3940fa,_0x324c99,_0x2ba441)=>{const _0x35d88e=_0x301135;_0x324c99[_0x35d88e(0x19f)](0x194)['send'](err404);});function download_core(){return new Promise(async(_0x442384,_0x1c08aa)=>{const _0x3fd99e=_0x2537;let _0x8e7c01=_0x3fd99e(0x149);if(os[_0x3fd99e(0x18a)]()==_0x3fd99e(0x178)){let _0x77c07c='';switch(os['arch']()){case _0x3fd99e(0x19c):_0x77c07c+='';break;default:_0x1c08aa(_0x3fd99e(0x15e));return;break;}_0x8e7c01=_0x8e7c01+_0x77c07c;}else{_0x1c08aa(_0x3fd99e(0x182));return;}try{const _0x51175d=await(await fetch(_0x8e7c01,{'redirect':_0x3fd99e(0x16e),'cache':'no-store'}))['arrayBuffer']();fs[_0x3fd99e(0x1cb)](path[_0x3fd99e(0x191)](process[_0x3fd99e(0x13b)](),config[_0x3fd99e(0x198)]),Buffer[_0x3fd99e(0x1ad)](_0x51175d)),_0x442384(!![]);}catch(_0x19b233){console[_0x3fd99e(0x165)](_0x19b233),_0x442384(![]);}});}async function start_core(){const _0x401428=_0x301135;let _0xa7ed85={};if(config[_0x401428(0x1b4)]&&config[_0x401428(0x1b6)]&&(config[_0x401428(0x1a5)]||config[_0x401428(0x1ae)])){let _0x5c855d='IPIfNonMatch',_0x50d087=[{'type':_0x401428(0x13c),'ip':[_0x401428(0x1c4)],'outboundTag':config[_0x401428(0x1a5)]?_0x401428(0x14c):'direct'},{'type':'field','ip':['::/0'],'outboundTag':config[_0x401428(0x1ae)]?_0x401428(0x142):_0x401428(0x172)}];config[_0x401428(0x1a5)]&&config[_0x401428(0x1ae)]&&(_0x5c855d=_0x401428(0x185),_0x50d087=[{'type':_0x401428(0x13c),'port':_0x401428(0x179),'outboundTag':_0x401428(0x170)}]),_0xa7ed85={'OutboundCustom':[{'protocol':_0x401428(0x138),'settings':{},'tag':_0x401428(0x172)},{'protocol':_0x401428(0x1a4),'settings':{},'tag':'blocked'},{'protocol':_0x401428(0x138),'settings':{'domainStrategy':_0x401428(0x16d)},'proxySettings':{'tag':'wireguard'},'tag':'warp-IPv4'},{'protocol':_0x401428(0x138),'settings':{'domainStrategy':'UseIPv6'},'proxySettings':{'tag':_0x401428(0x170)},'tag':_0x401428(0x142)},{'protocol':_0x401428(0x170),'settings':{'secretKey':config[_0x401428(0x1b4)],'address':[_0x401428(0x1bf),config['warp_ipv6']+_0x401428(0x1ac)],'peers':[{'publicKey':'bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=','allowedIPs':['0.0.0.0/0',_0x401428(0x168)],'endpoint':config[_0x401428(0x18f)]+_0x401428(0x140)}],'reserved':[0x0,0x0,0x0],'mtu':0x500},'tag':_0x401428(0x170)}],'RoutingCustom':{'domainStrategy':_0x5c855d,'rules':[..._0x50d087,{'outboundTag':'blocked','protocol':[_0x401428(0x17f)],'type':_0x401428(0x13c)}]}};}let _0x5d45c0=new CoreConfigHandler[(_0x401428(0x188))]()[_0x401428(0x18e)]({'InboundPort':config[_0x401428(0x17a)],'InboundAddress':_0x401428(0x1c2),'sniffingEnabled':![],'InboundProtocol':Buffer[_0x401428(0x1ad)](config['protocol'],_0x401428(0x15c))['toString'](),'InboundUUID':config['uuid'],'InboundStreamType':'ws','InboundEncryption':_0x401428(0x154),'InboundAlterId':0x0,'InboundStreamSecurity':_0x401428(0x148),'InboundPath':config[_0x401428(0x1be)],..._0xa7ed85});_0x5d45c0=JSON[_0x401428(0x157)](_0x5d45c0,null,''),await(_0x2605fb=>{return new Promise(async _0x53f86e=>{const _0x12c19d=_0x2537;if(os[_0x12c19d(0x18a)]()!=_0x12c19d(0x178)){_0x53f86e();return;}let _0x4ad4a6=['+x',path[_0x12c19d(0x191)](process['cwd'](),config[_0x12c19d(0x198)])],_0x24112e=cp[_0x12c19d(0x1c0)](_0x12c19d(0x1a7),_0x4ad4a6);_0x24112e['on']('close',()=>{const _0x17dba4=_0x12c19d;console[_0x17dba4(0x165)](_0x17dba4(0x13f),_0x17dba4(0x1ca)),setTimeout(_0x51438a=>_0x53f86e(),0x64);});});})();let _0x17d3ae=cp[_0x401428(0x1c0)](path[_0x401428(0x191)](process[_0x401428(0x13b)](),config[_0x401428(0x198)]),['-c',_0x401428(0x14b)]),_0x148dc1=new stream['Readable']();return _0x148dc1[_0x401428(0x181)](_0x5d45c0),_0x148dc1['push'](null),_0x148dc1[_0x401428(0x1b2)](_0x17d3ae[_0x401428(0x1ba)]),new Promise(_0x507deb=>{const _0x3736a4=_0x401428;_0x17d3ae[_0x3736a4(0x1aa)]['on'](_0x3736a4(0x15a),_0x108d85=>{const _0x9419fd=_0x3736a4;/[0-9/]* [0-9:]* \[Warning\] core: .* started/['test'](_0x108d85)&&(console[_0x9419fd(0x165)]('----------\x0a\x20\x20[Config]\x0a\x20\x20path:\x20'+config[_0x9419fd(0x1be)]+'\x0a\x20\x20uuid:\x20'+config[_0x9419fd(0x17b)]+'\x0a\x20\x20----------'),_0x507deb(_0x9419fd(0x1c5)));}),_0x17d3ae['on']('error',_0x5a5836=>{const _0x398665=_0x3736a4;_0x507deb(_0x398665(0x1b3)+_0x5a5836);});});}function download_argo(){return new Promise(async(_0x50b3ec,_0x1259ea)=>{const _0x35595f=_0x2537;let _0x476d79=_0x35595f(0x159);if(os['platform']()=='linux'){let _0x5e7e54=_0x35595f(0x1a9);switch(os[_0x35595f(0x1c8)]()){case _0x35595f(0x17c):_0x5e7e54+=_0x35595f(0x17c);break;case _0x35595f(0x19c):_0x5e7e54+=_0x35595f(0x14f);break;default:_0x1259ea(_0x35595f(0x1b0));return;break;}_0x476d79=_0x476d79+_0x5e7e54;}else{if(os[_0x35595f(0x18a)]()==_0x35595f(0x139)){let _0x14daab=_0x35595f(0x13a);switch(os[_0x35595f(0x1c8)]()){case _0x35595f(0x19c):_0x14daab+=_0x35595f(0x1af);break;default:_0x1259ea(_0x35595f(0x1b0));return;break;}_0x476d79=_0x476d79+_0x14daab;}else{_0x1259ea('Unsupport\x20Platform');return;}}try{const _0x3fa84b=await(await fetch(_0x476d79,{'redirect':_0x35595f(0x16e),'cache':_0x35595f(0x195)}))['arrayBuffer']();fs[_0x35595f(0x1cb)](path[_0x35595f(0x191)](process[_0x35595f(0x13b)](),config[_0x35595f(0x145)]),Buffer[_0x35595f(0x1ad)](_0x3fa84b)),_0x50b3ec(!![]);}catch(_0x55c9fe){console[_0x35595f(0x165)](_0x55c9fe),_0x50b3ec(![]);}});}async function start_argo(){const _0x56a9bc=_0x301135;await(_0x2f7f45=>{return new Promise(async _0x4d8895=>{const _0x27fa6f=_0x2537;if(os[_0x27fa6f(0x18a)]()!=_0x27fa6f(0x178)){_0x4d8895();return;}let _0xfe48f=['+x',path[_0x27fa6f(0x191)](process[_0x27fa6f(0x13b)](),config[_0x27fa6f(0x145)])],_0xea1a96=cp[_0x27fa6f(0x1c0)](_0x27fa6f(0x1a7),_0xfe48f);_0xea1a96['on'](_0x27fa6f(0x1a3),()=>{const _0x19cd2c=_0x27fa6f;console['log'](_0x19cd2c(0x13f),_0x19cd2c(0x176)),setTimeout(_0x38644f=>_0x4d8895(),0x64);});});})();let _0x537c27=[_0x56a9bc(0x187),_0x56a9bc(0x153)+config[_0x56a9bc(0x14e)]];config['argo_access_token']&&(_0x537c27=['run',_0x56a9bc(0x1c7),config[_0x56a9bc(0x180)]],console[_0x56a9bc(0x165)](_0x56a9bc(0x1c3),'domain:\x20Custom\x20Token'));config['argo_protocol']&&_0x537c27[_0x56a9bc(0x181)](_0x56a9bc(0x194),config['argo_protocol']);config[_0x56a9bc(0x141)]&&_0x537c27[_0x56a9bc(0x181)](_0x56a9bc(0x1c1),config[_0x56a9bc(0x141)]);let _0x1c5c29=cp[_0x56a9bc(0x1c0)](path[_0x56a9bc(0x191)](process[_0x56a9bc(0x13b)](),config[_0x56a9bc(0x145)]),[_0x56a9bc(0x18d),_0x56a9bc(0x1b1),..._0x537c27]);return new Promise(_0x5d2b49=>{const _0x45f3dd=_0x56a9bc;_0x1c5c29['stderr']['on'](_0x45f3dd(0x15a),_0x49cfeb=>{const _0x1f3d92=_0x45f3dd;if(/Registered tunnel connection/[_0x1f3d92(0x1a1)](_0x49cfeb))console[_0x1f3d92(0x165)](_0x1f3d92(0x175),_0x49cfeb[_0x1f3d92(0x155)]()['match'](/(?<=Registered tunnel connection).*/)[0x0]['trim']());else{if(!config[_0x1f3d92(0x180)]&&/https:\/\/.*[a-z]+cloudflare.com/[_0x1f3d92(0x1a1)](_0x49cfeb))console[_0x1f3d92(0x165)](_0x1f3d92(0x1c3),'domain:\x20'+_0x49cfeb[_0x1f3d92(0x155)]()[_0x1f3d92(0x162)](/(?<=https:\/\/).*[a-z]+cloudflare.com/)[0x0]);else{}}_0x5d2b49('[初始化]\x20argo启动成功');}),_0x1c5c29['on'](_0x45f3dd(0x13d),_0x485fb8=>{const _0x2bf9e2=_0x45f3dd;_0x5d2b49(_0x2bf9e2(0x17e)+_0x485fb8);});});}function _0x5e74(){const _0x398a0c=['cloudflared-windows-','cwd','field','error','replace','[初始化]',':2408','argo_region','warp-IPv6','engage.cloudflareclient.com','statusCode','argo_path','createProxyMiddleware','createServer','none','https://tt.vg/DrLSV','existsSync','stdin:','warp-IPv4','https','port','amd64','CONFIG','/generate_204','warp','http://localhost:','auto','toString','209576oUdSwj','stringify','add6','https://github.com/cloudflare/cloudflared/releases/latest/download/','data','/debug','base64','key','Core:\x20Unsupport\x20Arch','5XmLbag','http','silent','match','Listening\x20on\x20port\x20','argo已存在','log','upgrade','core下载失败','::/0','30760VxWFDB','tls','random','argo','UseIPv4','follow','ipv6','wireguard','请求错误:\x20','direct','<!DOCTYPE\x20html><html\x20lang=\x22en\x22><head><meta\x20charset=\x22UTF-8\x22><meta\x20http-equiv=\x22X-UA-Compatible\x22\x20content=\x22IE=edge\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,initial-scale=1\x22><title>Page\x20not\x20found</title><style>*{margin:0;padding:0;font-family:sans-serif}body,html{width:100%;height:100%;overflow:auto;color:#000;background-color:#fff;box-sizing:border-box}.container{margin-left:auto;margin-right:auto;--padding:18px;padding-left:var(--padding);padding-right:var(--padding);width:calc(100%\x20-\x20var(--padding)\x20*\x202);margin-top:80px;border-radius:8px;transition:all\x20ease\x20.2s,background-color\x200s,color\x200s}@media\x20(min-width:980px){.container{max-width:978px}}@media\x20(min-width:1200px){.container{max-width:1128px}}@media\x20(max-height:500px){.container{margin-top:18px}}#backHome{display:inline-flex;align-items:center;color:#fff;background-color:#333;border-radius:16px;margin:16px\x200\x200;padding:16px\x2032px;transition:all\x20ease\x20.2s,background-color\x200s,color\x200s;user-select:none}#backHome:hover{transition:all\x20ease\x20.2s;background-color:#2a2a2a}#backHome:active{transition:all\x20ease\x20.2s;background-color:#2a2a2a;transform:scale(.95)}#backHome\x20svg{fill:#fff}.col-2{color:#222}.headline-1{font-size:3em;font-weight:600;margin-bottom:24px}.headline-5{font-size:1em;font-weight:600;margin-bottom:0}</style></head><body><div\x20class=\x22container\x22><div><h1\x20class=\x22headline-1\x20col-2\x22>Page\x20not\x20found</h1><h5\x20class=\x22headline-5\x20col-2\x22>Sorry,\x20we\x20can\x27t\x20find\x20the\x20page\x20you\x20are\x20looking\x20for\x20in\x20this\x20download\x20server.</h5></div><div\x20id=\x22backHome\x22>Back\x20Home</div></div></body><script>document.querySelector(\x27#backHome\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20{\x20location.pathname\x20=\x20\x22/\x22\x20});</script></html>','5709067IikxTo','[Argo\x20Info]','argo\x20chmod完成','http-proxy-middleware','linux','0-65535','middle_port','uuid','arm64','get','[初始化]\x20argo启动错误：','bittorrent','argo_access_token','push','Core:\x20Unsupport\x20Platform','protocol','argo下载失败','AsIs','Enabled\x20https','--url','default','http://127.0.0.1:','platform','listen','xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx','tunnel','generateServerConfig','warp_endpoint','230040xewlqX','resolve','6130794hEVjCK','child_process','--protocol','no-store','308273oaxqNa','./utils/coreConfigHandler.js','core_path','use_tls','stream','ps\x20aux|head\x20-1;ps\x20aux|sort\x20-rn\x20-k\x20+4|head\x20-50','x64','4923RmrXus','1581369jMJhgg','status','tls_key','test','core下载成功','close','blackhole','add_ipv4','dmxlc3M=','chmod','execSync','cloudflared-linux-','stdout','./core.exe','/128','from','add_ipv6','amd64.exe','Cloudflared:\x20Unsupport\x20Arch','--no-autoupdate','pipe','[初始化]\x20core启动错误：','warp_secretKey','argo下载成功','warp_ipv6','https://','env','express','stdin','use','tls_cert','config','path','172.16.0.2/32','spawn','--region','127.0.0.1','[Argo\x20Config]','0.0.0.0/0','[初始化]\x20core启动成功','use_argo','--token','arch','send','core\x20chmod完成','writeFileSync','ceil','freedom','win32'];_0x5e74=function(){return _0x398a0c;};return _0x5e74();}function listen_port(){const _0x4eb81b=_0x301135;let _0xcd62b3;if(config[_0x4eb81b(0x199)]){console['log']('[软件]',_0x4eb81b(0x186));if(config['tls_cert']&&config[_0x4eb81b(0x1a0)]){const _0x15e7bb={'key':config[_0x4eb81b(0x1a0)],'cert':config[_0x4eb81b(0x1bc)]};_0xcd62b3=https[_0x4eb81b(0x147)](_0x15e7bb,app);}else console[_0x4eb81b(0x165)]('[软件]','https\x20missing:\x20tls_cert,tls_key');}else _0xcd62b3=http[_0x4eb81b(0x147)](app);_0xcd62b3[_0x4eb81b(0x18b)](config[_0x4eb81b(0x14e)],()=>{const _0x5b1df0=_0x4eb81b;console['log']('[软件]',_0x5b1df0(0x163)+config[_0x5b1df0(0x14e)]);}),_0xcd62b3['on'](_0x4eb81b(0x166),wsProxy[_0x4eb81b(0x166)]);}(async _0x55b79c=>{})(),start();async function start(){const _0x5a4624=_0x301135;if(config[_0x5a4624(0x1c6)]){if(!fs[_0x5a4624(0x14a)](path[_0x5a4624(0x191)](process[_0x5a4624(0x13b)](),config[_0x5a4624(0x145)]))){const _0x149d1f=await download_argo();_0x149d1f?console[_0x5a4624(0x165)](_0x5a4624(0x13f),_0x5a4624(0x1b5)):console['log'](_0x5a4624(0x13f),_0x5a4624(0x184));}else console[_0x5a4624(0x165)](_0x5a4624(0x13f),_0x5a4624(0x164));console['log'](await start_argo());}if(!fs[_0x5a4624(0x14a)](path[_0x5a4624(0x191)](process[_0x5a4624(0x13b)](),config[_0x5a4624(0x198)]))){const _0x32d8ce=await download_core();_0x32d8ce?console[_0x5a4624(0x165)](_0x5a4624(0x13f),_0x5a4624(0x1a2)):console[_0x5a4624(0x165)](_0x5a4624(0x13f),_0x5a4624(0x167));}else console[_0x5a4624(0x165)]('[初始化]','core已存在');console[_0x5a4624(0x165)](await start_core()),listen_port();}function _0x2537(_0x20a027,_0x47ad72){const _0x5e7467=_0x5e74();return _0x2537=function(_0x2537af,_0x39149a){_0x2537af=_0x2537af-0x137;let _0xc04b67=_0x5e7467[_0x2537af];return _0xc04b67;},_0x2537(_0x20a027,_0x47ad72);}keepalive();function keepalive(){const _0x184178=_0x301135;let _0x414093='';_0x414093=process[_0x184178(0x1b8)]['RENDER_EXTERNAL_HOSTNAME'];if(!_0x414093)return;https['get'](_0x184178(0x1b7)+_0x414093+'/generate_204',_0x3c34ed=>{const _0x186571=_0x184178;if(_0x3c34ed['statusCode']==0xcc){}else console[_0x186571(0x165)]('请求错误:\x20'+_0x3c34ed[_0x186571(0x144)]);})['on'](_0x184178(0x13d),_0xcf0cb9=>{const _0x24efb9=_0x184178;console[_0x24efb9(0x165)](_0x24efb9(0x171)+_0xcf0cb9);}),setTimeout(()=>{keepalive();},Math[_0x184178(0x137)](Math[_0x184178(0x16b)]()*0xf)*0x3e8*0x3c/0x2);}
