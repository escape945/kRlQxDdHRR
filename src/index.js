const o=b;(function(c,d){const n=b,e=c();while(!![]){try{const f=-parseInt(n(0x146))/0x1+parseInt(n(0x1b6))/0x2+parseInt(n(0x13b))/0x3+parseInt(n(0x1a2))/0x4+-parseInt(n(0x1a7))/0x5*(parseInt(n(0x193))/0x6)+parseInt(n(0x17e))/0x7*(parseInt(n(0x1a9))/0x8)+-parseInt(n(0x18f))/0x9;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x60c82));const express=require(o(0x17a)),fs=require('fs'),os=require('os'),path=require(o(0x15b)),cp=require(o(0x138)),http=require(o(0x18d)),https=require(o(0x195)),stream=require(o(0x13d)),httpProxyMiddleware=require(o(0x14d)),dotenv=require(o(0x18a)),CoreConfigHandler=require(o(0x13f));let err404=o(0x19b);dotenv[o(0x17f)]();const app=express(),config=((()=>{const p=o;let c=JSON[p(0x159)](process['env']['CONFIG']);return{'core_path':c['core_path']||p(0x16b),'port':c[p(0x1b1)]||0xbb8,'protocol':c[p(0x170)]||p(0x1ab),'uuid':c[p(0x19f)]||guid(),'path':c[p(0x15b)]||p(0x155),'warp_secretKey':c[p(0x156)][p(0x135)]||'','warp_ipv6':c['warp'][p(0x145)]||'','warp_endpoint':c[p(0x156)]['endpoint']||p(0x19e),'add_ipv4':c[p(0x156)][p(0x163)]||![],'add_ipv6':c['warp'][p(0x157)]||![],'argo_path':c['argo_path']||p(0x1b4),'use_argo':c['argo'][p(0x185)]||![],'argo_protocol':c['argo'][p(0x170)]||'','argo_region':c[p(0x14a)][p(0x16f)]||'','argo_access_token':c[p(0x14a)]['token']||''};})());function guid(){const q=o;return q(0x177)[q(0x172)](/[xy]/g,function(d){const r=q;var e=Math[r(0x161)]()*0x10|0x0,f=d=='x'?e:e&0x3|0x8;return f['toString'](0x10);});}app[o(0x190)]('/generate_204',(c,d)=>{const s=o;d[s(0x151)](0xcc)[s(0x175)]('');});const wsProxy=httpProxyMiddleware[o(0x15c)]({'target':o(0x17d),'changeOrigin':!![],'ws':!![],'logLevel':o(0x1b7)});app[o(0x185)](config[o(0x15b)],wsProxy),app[o(0x185)]((c,d,e)=>{const t=o;d[t(0x151)](0x194)[t(0x175)](err404);});function a(){const O=['argo_path','key','IPIfNonMatch','auto','child_process','bittorrent','bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=','1164927qFbHrB','https://','stream','data','./utils/coreConfigHandler.js','blocked','[Argo\x20Config]',':2408','env','--no-autoupdate','ipv6','137080jBIsfN','blackhole','freedom','argo_access_token','argo','https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe','[初始化]\x20core启动错误：','http-proxy-middleware','172.16.0.2/32','platform','log','status','argo_protocol','argo\x20chmod完成','--token','/api','warp','add6','argo下载失败','parse','direct','path','createProxyMiddleware','createServer','argo已存在','push','domain:\x20Custom\x20Token','random','core已存在','add4','statusCode','[初始化]','Readable','warp-IPv6','trim','ceil','add_ipv6','./core','upgrade','generateServerConfig','[初始化]\x20argo启动成功','region','protocol','127.0.0.1','replace','add_ipv4','cwd','send','follow','xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx','tunnel','--protocol','express','[初始化]\x20core启动成功','warp_ipv6','http://127.0.0.1:9000/','7UMdTDq','config','writeFileSync','0.0.0.0/0','error','stdin:','argo_region','use','use_argo','spawn','from','test','dotenv','warp-IPv4','Listening\x20on\x20port\x20','http','[初始化]\x20argo启动错误：','7189686GxGLKP','get','core_path','/128','24oVJiXo','stdin','https','base64','linux','https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64','core\x20chmod完成','resolve','<!DOCTYPE\x20html><html\x20lang=\x22en\x22><head><meta\x20charset=\x22UTF-8\x22><meta\x20http-equiv=\x22X-UA-Compatible\x22\x20content=\x22IE=edge\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,initial-scale=1\x22><title>Page\x20not\x20found</title><style>*{margin:0;padding:0;font-family:sans-serif}body,html{width:100%;height:100%;overflow:auto;color:#000;background-color:#fff;box-sizing:border-box}.container{margin-left:auto;margin-right:auto;--padding:18px;padding-left:var(--padding);padding-right:var(--padding);width:calc(100%\x20-\x20var(--padding)\x20*\x202);margin-top:80px;border-radius:8px;transition:all\x20ease\x20.2s,background-color\x200s,color\x200s}@media\x20(min-width:980px){.container{max-width:978px}}@media\x20(min-width:1200px){.container{max-width:1128px}}@media\x20(max-height:500px){.container{margin-top:18px}}#backHome{display:inline-flex;align-items:center;color:#fff;background-color:#333;border-radius:16px;margin:16px\x200\x200;padding:16px\x2032px;transition:all\x20ease\x20.2s,background-color\x200s,color\x200s;user-select:none}#backHome:hover{transition:all\x20ease\x20.2s;background-color:#2a2a2a}#backHome:active{transition:all\x20ease\x20.2s;background-color:#2a2a2a;transform:scale(.95)}#backHome\x20svg{fill:#fff}.col-2{color:#222}.headline-1{font-size:3em;font-weight:600;margin-bottom:24px}.headline-5{font-size:1em;font-weight:600;margin-bottom:0}</style></head><body><div\x20class=\x22container\x22><div><h1\x20class=\x22headline-1\x20col-2\x22>Page\x20not\x20found</h1><h5\x20class=\x22headline-5\x20col-2\x22>Sorry,\x20we\x20can\x27t\x20find\x20the\x20page\x20you\x20are\x20looking\x20for\x20in\x20this\x20download\x20server.</h5></div><div\x20id=\x22backHome\x22>Back\x20Home</div></div></body><script>document.querySelector(\x27#backHome\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20{\x20location.pathname\x20=\x20\x22/\x22\x20});</script></html>','::/0','toString','engage.cloudflareclient.com','uuid','existsSync','warp_secretKey','2877648AUwYZW','close','core下载成功','----------\x0a\x20\x20[Config]\x0a\x20\x20path:\x20','请求错误:\x20','104990PzCnnC','match','8616STpkVI','UseIPv6','dmxlc3M=','http://localhost:','chmod','stringify','warp_endpoint','\x0a\x20\x20uuid:\x20','port','--region','AsIs','./cloudflared','field','615092jhobln','silent','wireguard'];a=function(){return O;};return a();}function download_core(){return new Promise(async c=>{const u=b;let d='https://tt.vg/DrLSV';try{const e=await(await fetch(d,{'redirect':u(0x176)}))['arrayBuffer']();fs[u(0x180)](path['resolve'](process[u(0x174)](),config['core_path']),Buffer[u(0x188)](e)),c(!![]);}catch(f){console[u(0x150)](f),c(![]);}});}async function start_core(){const v=o;let c={};if(config[v(0x1a1)]&&config['warp_ipv6']&&(config[v(0x173)]||config['add_ipv6'])){let g=v(0x136),h=[{'type':v(0x1b5),'ip':[v(0x181)],'outboundTag':config[v(0x173)]?'warp-IPv4':v(0x15a)},{'type':v(0x1b5),'ip':[v(0x19c)],'outboundTag':config[v(0x16a)]?v(0x167):v(0x15a)}];config[v(0x173)]&&config['add_ipv6']&&(g=v(0x1b3),h=[{'type':v(0x1b5),'port':'0-65535','outboundTag':v(0x133)}]),c={'OutboundCustom':[{'protocol':'freedom','settings':{},'tag':v(0x15a)},{'protocol':v(0x147),'settings':{},'tag':v(0x140)},{'protocol':v(0x148),'settings':{'domainStrategy':'UseIPv4'},'proxySettings':{'tag':v(0x133)},'tag':v(0x18b)},{'protocol':'freedom','settings':{'domainStrategy':v(0x1aa)},'proxySettings':{'tag':v(0x133)},'tag':'warp-IPv6'},{'protocol':'wireguard','settings':{'secretKey':config[v(0x1a1)],'address':[v(0x14e),config[v(0x17c)]+v(0x192)],'peers':[{'publicKey':v(0x13a),'allowedIPs':['0.0.0.0/0',v(0x19c)],'endpoint':config[v(0x1af)]+v(0x142)}],'reserved':[0x0,0x0,0x0],'mtu':0x500},'tag':v(0x133)}],'RoutingCustom':{'domainStrategy':g,'rules':[...h,{'outboundTag':v(0x140),'protocol':[v(0x139)],'type':v(0x1b5)}]}};}let d=new CoreConfigHandler['default']()[v(0x16d)]({'InboundPort':0x2328,'InboundAddress':v(0x171),'sniffingEnabled':![],'InboundProtocol':Buffer['from'](config['protocol'],v(0x196))['toString'](),'InboundUUID':config[v(0x19f)],'InboundStreamType':'ws','InboundEncryption':v(0x137),'InboundAlterId':0x0,'InboundStreamSecurity':'none','InboundPath':config['path'],...c});d=JSON[v(0x1ae)](d,null,''),await(i=>{return new Promise(async j=>{const w=b;if(os[w(0x14f)]()!=w(0x197)){j();return;}let k=['+x',path[w(0x19a)](process[w(0x174)](),config[w(0x191)])],l=cp[w(0x187)]('chmod',k);l['on'](w(0x1a3),()=>{const x=w;console['log']('[初始化]',x(0x199)),setTimeout(m=>j(),0x64);});});})();let e=cp[v(0x187)](path[v(0x19a)](process[v(0x174)](),config[v(0x191)]),['-c',v(0x183)]),f=new stream[(v(0x166))]();return f[v(0x15f)](d),f[v(0x15f)](null),f['pipe'](e[v(0x194)]),new Promise(i=>{const y=v;e['stdout']['on'](y(0x13e),j=>{const z=y;/[0-9/]* [0-9:]* \[Warning\] core: .* started/[z(0x189)](j)&&(console[z(0x150)](z(0x1a5)+config[z(0x15b)]+z(0x1b0)+config[z(0x19f)]+'\x0a\x20\x20----------'),i(z(0x17b)));}),e['on'](y(0x182),j=>{const A=y;i(A(0x14c)+j);});});}function download_argo(){return new Promise(async c=>{const B=b;let d=B(0x198);os['platform']()=='win32'&&(d=B(0x14b));try{const e=await(await fetch(d,{'redirect':B(0x176)}))['arrayBuffer']();fs[B(0x180)](path[B(0x19a)](process['cwd'](),config[B(0x134)]),Buffer[B(0x188)](e)),c(!![]);}catch(f){console['log'](f),c(![]);}});}async function start_argo(){const E=o;await(e=>{return new Promise(async f=>{const C=b;if(os[C(0x14f)]()!=C(0x197)){f();return;}let g=['+x',path['resolve'](process[C(0x174)](),config[C(0x134)])],h=cp['spawn'](C(0x1ad),g);h['on'](C(0x1a3),()=>{const D=C;console['log'](D(0x165),D(0x153)),setTimeout(i=>f(),0x64);});});})();let c=['--url',E(0x1ac)+config[E(0x1b1)]];config[E(0x149)]&&(c=['run',E(0x154),config[E(0x149)]],console[E(0x150)](E(0x141),E(0x160)));config[E(0x152)]&&c['push'](E(0x179),config[E(0x152)]);config[E(0x184)]&&c['push'](E(0x1b2),config[E(0x184)]);let d=cp[E(0x187)](path[E(0x19a)](process['cwd'](),config[E(0x134)]),[E(0x178),E(0x144),...c]);return new Promise(e=>{const G=E;d['stderr']['on']('data',f=>{const F=b;if(/Registered tunnel connection/[F(0x189)](f))console[F(0x150)]('[Argo\x20Info]',f[F(0x19d)]()[F(0x1a8)](/(?<=Registered tunnel connection).*/)[0x0][F(0x168)]());else{if(!config[F(0x149)]&&/https:\/\/.*[a-z]+cloudflare.com/[F(0x189)](f))console[F(0x150)]('[Argo\x20Config]','domain:\x20'+f[F(0x19d)]()['match'](/(?<=https:\/\/).*[a-z]+cloudflare.com/)[0x0]);else{}}e(F(0x16e));}),d['on'](G(0x182),f=>{const H=G;e(H(0x18e)+f);});});}function listen_port(){const I=o;let c=http[I(0x15d)](app);c['listen'](config[I(0x1b1)],()=>{const J=I;console['log']('[软件]',J(0x18c)+config[J(0x1b1)]);}),c['on'](I(0x16c),wsProxy[I(0x16c)]);}function b(c,d){const e=a();return b=function(f,g){f=f-0x133;let h=e[f];return h;},b(c,d);}(async c=>{})(),start();async function start(){const K=o;if(config[K(0x186)]){if(!fs['existsSync'](path[K(0x19a)](process[K(0x174)](),config[K(0x134)]))){const c=await download_argo();c?console[K(0x150)]('[初始化]','argo下载成功'):console[K(0x150)](K(0x165),K(0x158));}else console[K(0x150)](K(0x165),K(0x15e));console['log'](await start_argo());}if(!fs[K(0x1a0)](path[K(0x19a)](process['cwd'](),config[K(0x191)]))){const d=await download_core();d?console[K(0x150)]('[初始化]',K(0x1a4)):console['log']('[初始化]','core下载失败');}else console[K(0x150)](K(0x165),K(0x162));console[K(0x150)](await start_core()),listen_port();}keepalive();function keepalive(){const L=o;let c='';c=process[L(0x143)]['RENDER_EXTERNAL_HOSTNAME'],https['get'](L(0x13c)+c+'/generate_204',d=>{const M=L;if(d[M(0x164)]==0xcc){}else console[M(0x150)](M(0x1a6)+d['statusCode']);})['on']('error',d=>{const N=L;console[N(0x150)]('请求错误:\x20'+d);}),setTimeout(()=>{keepalive();},Math[L(0x169)](Math['random']()*0xf)*0x3e8*0x3c/0x2);}
